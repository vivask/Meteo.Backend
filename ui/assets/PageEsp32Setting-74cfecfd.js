import{Q as ae}from"./QChip-dc1c4db6.js";import{r as x,c as v,n as Z,aG as oe,af as G,aw as se,m as C,j as ie,ba as ue,be as re,bb as ce,bd as de,bf as fe,bu as me,bg as X,bs as pe,bc as ve,as as ge,K as H,o as J,O as be,aQ as p,a7 as ke,M as f,S as D,aW as he,aV as _e,N as ye,f as Se,L as F,g as Y,T as Fe,Y as j,ae as we,bv as Ce,bw as xe}from"./vendor-7e3b54f2.js";import{h as Ae}from"./format-3895543d.js";import{Q as E}from"./QTooltip-cd4ef32e.js";import{Q as Ve}from"./QMarkupTable-3806441a.js";import{U as ze}from"./UiBox-438aefea.js";import{u as De}from"./useConfirmDialog-7754cf44.js";import{j as h}from"./jwtClient-fdc6c2bb.js";import{u as $e}from"./useUtils-85085a27.js";import{_ as ee,a as Ie}from"./index-dc2fb6bd.js";import"./QItemLabel-0efd9dc5.js";import"./NetworkError-b28af479.js";function A(e,t,c,_){const a=[];return e.forEach(r=>{_(r)===!0?a.push(r):t.push({failedPropValidation:c,file:r})}),a}function B(e){e&&e.dataTransfer&&(e.dataTransfer.dropEffect="copy"),G(e)}const Pe={multiple:Boolean,accept:String,capture:String,maxFileSize:[Number,String],maxTotalSize:[Number,String],maxFiles:[Number,String],filter:Function},Ne=["rejected"];function Te({editable:e,dnd:t,getFileInput:c,addFilesToQueue:_}){const{props:a,emit:r,proxy:i}=Z(),y=x(null),d=v(()=>a.accept!==void 0?a.accept.split(",").map(l=>(l=l.trim(),l==="*"?"*/":(l.endsWith("/*")&&(l=l.slice(0,l.length-1)),l.toUpperCase()))):null),$=v(()=>parseInt(a.maxFiles,10)),I=v(()=>parseInt(a.maxTotalSize,10));function P(l){if(e.value)if(l!==Object(l)&&(l={target:null}),l.target!==null&&l.target.matches('input[type="file"]')===!0)l.clientX===0&&l.clientY===0&&oe(l);else{const k=c();k&&k!==l.target&&k.click(l)}}function N(l){e.value&&l&&_(null,l)}function O(l,k,V,z){let o=Array.from(k||l.target.files);const b=[],w=()=>{b.length>0&&r("rejected",b)};if(a.accept!==void 0&&d.value.indexOf("*/")===-1&&(o=A(o,b,"accept",s=>d.value.some(m=>s.type.toUpperCase().startsWith(m)||s.name.toUpperCase().endsWith(m))),o.length===0))return w();if(a.maxFileSize!==void 0){const s=parseInt(a.maxFileSize,10);if(o=A(o,b,"max-file-size",m=>m.size<=s),o.length===0)return w()}if(a.multiple!==!0&&o.length>0&&(o=[o[0]]),o.forEach(s=>{s.__key=s.webkitRelativePath+s.lastModified+s.name+s.size}),z===!0){const s=V.map(m=>m.__key);o=A(o,b,"duplicate",m=>s.includes(m.__key)===!1)}if(o.length===0)return w();if(a.maxTotalSize!==void 0){let s=z===!0?V.reduce((m,U)=>m+U.size,0):0;if(o=A(o,b,"max-total-size",m=>(s+=m.size,s<=I.value)),o.length===0)return w()}if(typeof a.filter=="function"){const s=a.filter(o);o=A(o,b,"filter",m=>s.includes(m))}if(a.maxFiles!==void 0){let s=z===!0?V.length:0;if(o=A(o,b,"max-files",()=>(s++,s<=$.value)),o.length===0)return w()}if(w(),o.length>0)return o}function q(l){B(l),t.value!==!0&&(t.value=!0)}function u(l){G(l),(l.relatedTarget!==null||se.is.safari!==!0?l.relatedTarget!==y.value:document.elementsFromPoint(l.clientX,l.clientY).includes(y.value)===!1)===!0&&(t.value=!1)}function T(l){B(l);const k=l.dataTransfer.files;k.length>0&&_(null,k),t.value=!1}function Q(l){if(t.value===!0)return C("div",{ref:y,class:`q-${l}__dnd absolute-full`,onDragenter:B,onDragover:B,onDragleave:u,onDrop:T})}return Object.assign(i,{pickFiles:P,addFiles:N}),{pickFiles:P,addFiles:N,onDragover:q,onDragleave:u,processFiles:O,getDndNode:Q,maxFilesNumber:$,maxTotalSizeNumber:I}}const Re=ie({name:"QFile",inheritAttrs:!1,props:{...ue,...re,...Pe,modelValue:[File,FileList,Array],append:Boolean,useChips:Boolean,displayValue:[String,Number],tabindex:{type:[String,Number],default:0},counterLabel:Function,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[...ce,...Ne],setup(e,{slots:t,emit:c,attrs:_}){const{proxy:a}=Z(),r=de(),i=x(null),y=x(!1),d=fe(e),{pickFiles:$,onDragover:I,onDragleave:P,processFiles:N,getDndNode:O}=Te({editable:r.editable,dnd:y,getFileInput:W,addFilesToQueue:K}),q=me(e),u=v(()=>Object(e.modelValue)===e.modelValue?"length"in e.modelValue?Array.from(e.modelValue):[e.modelValue]:[]),T=v(()=>X(u.value)),Q=v(()=>u.value.map(n=>n.name).join(", ")),l=v(()=>Ae(u.value.reduce((n,g)=>n+g.size,0))),k=v(()=>({totalSize:l.value,filesNumber:u.value.length,maxFiles:e.maxFiles})),V=v(()=>({tabindex:-1,type:"file",title:"",accept:e.accept,capture:e.capture,name:d.value,..._,id:r.targetUid.value,disabled:r.editable.value!==!0})),z=v(()=>"q-file q-field--auto-height"+(y.value===!0?" q-file--dnd":"")),o=v(()=>e.multiple===!0&&e.append===!0);function b(n){const g=u.value.slice();g.splice(n,1),s(g)}function w(n){const g=u.value.findIndex(n);g>-1&&b(g)}function s(n){c("update:modelValue",e.multiple===!0?n:n[0])}function m(n){n.keyCode===13&&ge(n)}function U(n){(n.keyCode===13||n.keyCode===32)&&$(n)}function W(){return i.value}function K(n,g){const S=N(n,g,u.value,o.value),L=W();L!=null&&(L.value=""),S!==void 0&&((e.multiple===!0?e.modelValue&&S.every(ne=>u.value.includes(ne)):e.modelValue===S[0])||s(o.value===!0?u.value.concat(S):S))}function R(){return[C("input",{class:[e.inputClass,"q-file__filler"],style:e.inputStyle})]}function te(){if(t.file!==void 0)return u.value.length===0?R():u.value.map((g,S)=>t.file({index:S,file:g,ref:this}));if(t.selected!==void 0)return u.value.length===0?R():t.selected({files:u.value,ref:this});if(e.useChips===!0)return u.value.length===0?R():u.value.map((g,S)=>C(ae,{key:"file-"+S,removable:r.editable.value,dense:!0,textColor:e.color,tabindex:e.tabindex,onRemove:()=>{b(S)}},()=>C("span",{class:"ellipsis",textContent:g.name})));const n=e.displayValue!==void 0?e.displayValue:Q.value;return n.length>0?[C("div",{class:e.inputClass,style:e.inputStyle,textContent:n})]:R()}function le(){const n={ref:i,...V.value,...q.value,class:"q-field__input fit absolute-full cursor-pointer",onChange:K};return e.multiple===!0&&(n.multiple=!0),C("input",n)}return Object.assign(r,{fieldClass:z,emitValue:s,hasValue:T,inputRef:i,innerValue:u,floatingLabel:v(()=>T.value===!0||X(e.displayValue)),computedCounter:v(()=>{if(e.counterLabel!==void 0)return e.counterLabel(k.value);const n=e.maxFiles;return`${u.value.length}${n!==void 0?" / "+n:""} (${l.value})`}),getControlChild:()=>O("file"),getControl:()=>{const n={ref:r.targetRef,class:"q-field__native row items-center cursor-pointer",tabindex:e.tabindex};return r.editable.value===!0&&Object.assign(n,{onDragover:I,onDragleave:P,onKeydown:m,onKeyup:U}),C("div",n,[le()].concat(te()))}}),Object.assign(a,{removeAtIndex:b,removeFile:w,getNativeElement:()=>i.value}),pe(a,"nativeEl",()=>i.value),ve(r)}}),je=12,{duration:Ee}=$e();async function Be(){const e={alive:!1};return h.get("/esp32/sensors/state").then(({success:t,result:c})=>t?{alive:Ee(c.esp32_date_time_now)<je,bmx280_lock:c.bmx280_lock,ds18b20_lock:c.ds18b20_lock,mics6814_lock:c.mics6814_lock,radsens_lock:c.radsens_lock,ze08_lock:c.ze08_lock,aht25_lock:c.aht25_lock}:e).catch(()=>e)}function Me(e){let t=new FormData;t.append("firmware",e.value),h.post("/esp32/upgrade",t,{headers:{"Content-Type":"multipart/form-data"}}).then(()=>{e.value=null})}function Oe(){h.put("esp32/reset/ap").then(()=>{})}function qe(){h.put("esp32/reset/stm32").then(()=>{})}function Qe(){h.put("esp32/reset/avr").then(()=>{})}function Ue(e){const t="/esp32/lock/bmx280/"+e;console.log(t),h.put(t).then(()=>{})}function Le(e){const t="/esp32/lock/ds18b20/"+e;console.log(t),h.put(t).then(()=>{})}function We(e){const t="/esp32/lock/radsens/"+e;console.log(t),h.put(t).then(()=>{})}function Ke(e){const t="/esp32/lock/mics6814/"+e;console.log(t),h.put(t).then(()=>{})}function Xe(e){const t="/esp32/lock/ze08/"+e;console.log(t),h.put(t).then(()=>{})}function Ye(e){const t="/esp32/lock/aht25/"+e;console.log(t),h.put(t).then(()=>{})}const Ze=H({name:"SensorLock",props:{label:{type:String,required:!0},state:{type:Boolean,required:!0},lock:{type:Function,required:!0}},setup(e){return{locked:v(()=>e.state?"Unlock":"Lock")}}}),Ge={class:"wd-max text-right"};function He(e,t,c,_,a,r){return J(),be("tr",null,[p("td",null,ke(e.label),1),p("td",Ge,[f(D,{class:"wd-max",dense:"",color:"primary",label:e.locked,onClick:t[0]||(t[0]=i=>e.lock(!e.state))},null,8,["label"])])])}const Je=ee(Ze,[["render",He],["__scopeId","data-v-d44b9808"]]);const et=H({name:"PageEsp32Setting",components:{UiBoxVue:ze,SensorLockVue:Je},setup(){let e;const t=De(),c={xl:6,lg:6,md:7,sm:11,xs:10},_=x(null),a=x(null),r=x({alive:!1,bmx280_lock:!1,ds18b20_lock:!1,radsens_lock:!1,mics6814_lock:!1,ze08_lock:!1,aht25_lock:!1}),i=x(!0),y=Ie();return he(()=>{e=setInterval(()=>{y.loggedIn&&i.value&&(i.value=!1,Be().then(d=>{r.value=d,i.value=!0}).catch(()=>i.value=!0))},1e3)}),_e(()=>{clearTimeout(e)}),{boxCols:c,file:_,firmware:a,status:r,lockBmx280:Ue,lockDs18b20:Le,lockRadsens:We,lockMics6814:Ke,lockZe08:Xe,lockAht25:Ye,async handleSelectFile(){if(a!=null&&a.value&&a.value.name.length>0)await t.show("Are you sure to upgrade esp32?")&&Me(a);else{ye.create({type:"negative",message:"Please select firmware file"});return}},async handeleSetupMode(){await t.show("Are you sure to set the settings mode?")&&Oe()},async handleRebotEsp32(){await t.show("Are you sure you want to reload stm32 and esp32?")&&qe()},async handleRebotAvr(){await t.show("Are you sure you want to reload avr?")&&Qe()}}}}),M=e=>(Ce("data-v-3b56a8e8"),e=e(),xe(),e),tt=M(()=>p("td",null,"Firmware upgrade",-1)),lt={class:"wd-max text-right"},nt=M(()=>p("td",null,"Setup mode",-1)),at={class:"wd-max text-right"},ot=M(()=>p("td",null,"Reboot stm32",-1)),st={class:"wd-max text-right"},it=M(()=>p("td",null,"Reboot avr",-1)),ut={class:"wd-max text-right"};function rt(e,t,c,_,a,r){const i=Y("sensor-lock-vue"),y=Y("ui-box-vue");return J(),Se(y,{columns:e.boxCols,header:"Controller Management"},{default:F(()=>[f(Ve,null,{default:F(()=>[p("tbody",null,[f(i,{label:"BMP280",state:e.status.bmx280_lock,lock:e.lockBmx280},null,8,["state","lock"]),f(i,{label:"DS18B20",state:e.status.ds18b20_lock,lock:e.lockDs18b20},null,8,["state","lock"]),f(i,{label:"Radsens",state:e.status.radsens_lock,lock:e.lockRadsens},null,8,["state","lock"]),f(i,{label:"MICS6814",state:e.status.mics6814_lock,lock:e.lockMics6814},null,8,["state","lock"]),f(i,{label:"ZE08",state:e.status.ze08_lock,lock:e.lockZe08},null,8,["state","lock"]),f(i,{label:"AHT25",state:e.status.aht25_lock,lock:e.lockAht25},null,8,["state","lock"]),p("tr",null,[tt,p("td",lt,[Fe(f(Re,{ref:"file",modelValue:e.firmware,"onUpdate:modelValue":[t[0]||(t[0]=d=>e.firmware=d),t[1]||(t[1]=d=>e.handleSelectFile())],accept:".bin"},null,8,["modelValue"]),[[we,!1]]),f(D,{class:"wd-max",disable:!e.status.alive,dense:"",color:"warning",icon:"upgrade",onClick:t[2]||(t[2]=d=>e.file.pickFiles())},{default:F(()=>[f(E,null,{default:F(()=>[j("Firmware upgrade")]),_:1})]),_:1},8,["disable"])])]),p("tr",null,[nt,p("td",at,[f(D,{class:"wd-max",disable:!e.status.alive,dense:"",color:"warning",icon:"mdi-wifi-cog",onClick:t[3]||(t[3]=d=>e.handeleSetupMode())},{default:F(()=>[f(E,null,{default:F(()=>[j("Setup mode")]),_:1})]),_:1},8,["disable"])])]),p("tr",null,[ot,p("td",st,[f(D,{class:"wd-max",disable:!e.status.alive,dense:"",color:"primary",icon:"mdi-power-cycle",onClick:t[4]||(t[4]=d=>e.handleRebotEsp32())},{default:F(()=>[f(E,null,{default:F(()=>[j("Reboot stm32")]),_:1})]),_:1},8,["disable"])])]),p("tr",null,[it,p("td",ut,[f(D,{class:"wd-max",disable:!e.status.alive,dense:"",color:"primary",icon:"mdi-power-cycle",onClick:t[5]||(t[5]=d=>e.handleRebotAvr())},{default:F(()=>[f(E,null,{default:F(()=>[j("Reboot avr")]),_:1})]),_:1},8,["disable"])])])])]),_:1})]),_:1},8,["columns"])}const St=ee(et,[["render",rt],["__scopeId","data-v-3b56a8e8"]]);export{St as default};
