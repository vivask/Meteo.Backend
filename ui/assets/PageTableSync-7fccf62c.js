import{K as k,r as u,c as S,k as g,N as b,o as C,f as V,L as s,g as x,M as n,b7 as w,S as p,bv as B,bw as T,aQ as f}from"./vendor-7e3b54f2.js";import{U as $,Q as M}from"./UiBox-438aefea.js";import{a as r,b as Q,Q as z}from"./QTable-f6f16d1c.js";import{j as v}from"./jwtClient-fdc6c2bb.js";import{u as U}from"./useConfirmDialog-7754cf44.js";import{_ as I}from"./index-dc2fb6bd.js";import"./QItemLabel-0efd9dc5.js";import"./QTooltip-cd4ef32e.js";import"./QMenu-7e13e904.js";import"./QMarkupTable-3806441a.js";import"./QChip-dc1c4db6.js";import"./QItemSection-cefe5148.js";import"./format-3895543d.js";import"./NetworkError-b28af479.js";async function A(){const a=[];return v.get("/database/tables").then(({success:i,result:o})=>{if(i){for(let t in o){o[t].selected=!1,o[t].direction="Main => Back";for(let c in o[t].params)o[t].params[c].note=o[t].params[c].stype.note;o[t].method=o[t].params[0]}return o}else return a}).catch(()=>a)}async function y(a){const i=`/database/${a.method.stype.id}/${a.name}/${a.direction==="Main => Back"?"forward":"back"}`;return await v.put(i).then(({success:o})=>o).catch(()=>!1)}const D=[{name:"selected"},{name:"name",align:"left",field:"name",sortable:!0},{name:"method",classes:"wd-180"},{name:"direction"},{name:"action"}],N=k({name:"PageTableSync",components:{UiBoxVue:$},setup(){const a=u([]),i=u(!1),o=u([]),t={xl:6,lg:6,md:7,sm:11,xs:10},c=S(()=>a.value.length===0),m=U();g(async()=>o.value=await A());const d=async()=>{let e=await m.show("Synchronizing multiple tables will take a long time. Continue?");if(e){for(let l of a.value)e=await y(l),e&&b.create({type:"info",message:`Table ${l.name} synchronization success!`});a.value=[]}};return{selected:a,allSelected:i,columns:D,rows:o,boxCols:t,disable:c,handleAllSync:d,handleSelectedAll(e){if(e){for(let l in o.value)o.value[l].selected=!0;a.value=o.value}else{for(let l in o.value)o.value[l].selected=!1;a.value=[]}},handleSelected(e,l){l?a.value.push(e):a.value=a.value.filter(_=>_!==e)},handleDirection(e){o.value[e].direction=o.value[e].direction==="Main => Back"?"Back => Main":"Main => Back"},async handleSync(e){if(a.value.length)d();else{let l=await m.show("Synchronization will take some time. Continue?");l&&(l=await y(e),l&&b.create({type:"info",message:`Table ${e.name} synchronization success!`}))}}}}}),h=a=>(B("data-v-1aa6441f"),a=a(),T(),a),q=h(()=>f("p",{class:"header-table text-caption"},"Table",-1)),P=h(()=>f("p",{class:"header-method text-caption"},"Method",-1)),j=h(()=>f("p",{class:"header-direction text-caption"},"Direction",-1));function K(a,i,o,t,c,m){const d=x("ui-box-vue");return C(),V(d,{columns:a.boxCols,header:"Table Synchronization"},{default:s(()=>[n(z,{"hide-header":"",rows:a.rows,columns:a.columns,"row-key":"name","rows-per-page-options":[0,10,50,100]},{top:s(()=>[n(w,{modelValue:a.allSelected,"onUpdate:modelValue":[i[0]||(i[0]=e=>a.allSelected=e),a.handleSelectedAll],color:"grey"},null,8,["modelValue","onUpdate:modelValue"]),q,P,j,n(M),n(p,{class:"q-ml-xs",dense:"",color:"warning",size:"md",icon:"sync",disabled:a.disable,onClick:a.handleAllSync},null,8,["disabled","onClick"])]),"body-cell-selected":s(e=>[n(r,{props:e,class:"wd-50"},{default:s(()=>[n(w,{modelValue:e.row.selected,"onUpdate:modelValue":[l=>e.row.selected=l,l=>a.handleSelected(e.row,l)],color:"grey"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-method":s(e=>[n(r,{props:e},{default:s(()=>[n(Q,{modelValue:e.row.method,"onUpdate:modelValue":l=>e.row.method=l,standout:"",dense:"",options:e.row.params,"option-label":"note"},null,8,["modelValue","onUpdate:modelValue","options"])]),_:2},1032,["props"])]),"body-cell-direction":s(e=>[n(r,{props:e},{default:s(()=>[n(p,{class:"q-ml-xs",dense:"",color:e.row.direction==="Main => Back"?"positive":"warning",size:"md",val:e.rowIndex,label:e.row.direction,onClick:l=>a.handleDirection(e.rowIndex)},null,8,["color","val","label","onClick"])]),_:2},1032,["props"])]),"body-cell-action":s(e=>[n(r,{props:e},{default:s(()=>[n(p,{class:"q-ml-xs",dense:"",color:e.row.direction==="Main => Back"?"positive":"warning",size:"md",icon:"sync",onClick:l=>a.handleSync(e.row)},null,8,["color","onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns"])]),_:1},8,["columns"])}const oe=I(N,[["render",K],["__scopeId","data-v-1aa6441f"]]);export{oe as default};
