import{K as S,r as c,g as b,o as k,f as Q,L as t,M as o,aT as g,b0 as U,a_ as B,b2 as D,S as h,aS as V,b3 as F,c as _,O as C,X as P,R as E,k as M,N as L,a6 as W,aQ as T,a7 as A}from"./vendor-7e3b54f2.js";import{Q as I,a as y}from"./QTable-f6f16d1c.js";import{U as z}from"./UiBox-438aefea.js";import{U as N}from"./UiRoundBtn-7ea8dd22.js";import{t as G}from"./tableWrapper-c43f1a46.js";import{j as H}from"./jwtClient-fdc6c2bb.js";import{u as K}from"./useTableHandlers-649b36f2.js";import{Q as q}from"./QForm-dd93a313.js";import{U as R}from"./UiInput-ff5536f7.js";import{u as j}from"./useSubmitForm-841c2b76.js";import{_ as $}from"./index-dc2fb6bd.js";import{u as O}from"./useConfirmDialog-7754cf44.js";import"./QMenu-7e13e904.js";import"./QTooltip-cd4ef32e.js";import"./QMarkupTable-3806441a.js";import"./QChip-dc1c4db6.js";import"./QItemLabel-0efd9dc5.js";import"./QItemSection-cefe5148.js";import"./format-3895543d.js";import"./NetworkError-b28af479.js";const X="/schedule/tasks";function J(e){return G(X,e)}async function Y(e){const a="/schedule/task/run/";return await H.put(a,{api:e}).then(({success:s})=>s).catch(()=>!1)}const Z=S({name:"FormTaskParam",components:{UiInputVue:R},emits:["cancel","submit"],setup(e,{emit:a}){const s=c(null),{localProp:u,show:m,handleSubmit:d,handleCancel:l}=j(s,a);return{localProp:u,popup:s,show:m,handleSubmit:d,handleCancel:l}}});function x(e,a,s,u,m,d){const l=b("ui-input-vue");return k(),Q(F,{ref:"popup","transition-show":"rotate","transition-hide":"rotate",persistent:""},{default:t(()=>[o(V,{style:{"min-width":"300px"}},{default:t(()=>[o(g,null,{default:t(()=>[o(q,{class:"q-gutter-md",onSubmit:U(e.handleSubmit,["prevent"])},{default:t(()=>[o(l,{modelValue:e.localProp.name,"onUpdate:modelValue":a[0]||(a[0]=r=>e.localProp.name=r),hint:"Parameter name *"},null,8,["modelValue"]),o(B,{modelValue:e.localProp.note,"onUpdate:modelValue":a[1]||(a[1]=r=>e.localProp.note=r),dense:"",outlined:"",hint:"Parameter note"},null,8,["modelValue"]),o(D,{align:"left",class:"text-primary"},{default:t(()=>[o(h,{label:"Submit",type:"submit",color:"primary"}),o(h,{label:"Cancel",color:"primary",flat:"",class:"q-ml-sm",onClick:e.handleCancel},null,8,["onClick"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},512)}const ee=$(Z,[["render",x]]);const oe=[{name:"name",align:"left",field:"name",style:"max-width: 40px; width: 40px;"},{name:"note",align:"left",field:"note",style:"font-style: italic; max-width: 70px; width: 70px;"},{name:"actions"}],ae=S({name:"FormTask",components:{UiInputVue:R,UiRoundBtnVue:N,FormTaskParamVue:ee},emits:["cancel","submit"],setup(e,{emit:a}){const s=c(null),u=c(null),m=c(!1),d=_(()=>m.value?"<<":">>"),{localProp:l,show:r,handleSubmit:f,handleCancel:n,isUpdate:p}=j(s,a),v=O();return{localProp:l,popup:s,form:u,columns:oe,confirm:v,labelBtnParams:d,showParams:m,disable:_(()=>p.value),showBtnAddParam:_(()=>{var i;return m.value?(i=l.value)!=null&&i.params?l.value.params.length===0:!0:!1}),show:r,handleSubmit:f,handleCancel:n,handleAdd(){u.value.show({})},handleEdit(i){u.value.show(i)},async handleDelete(i){await v.show("Are you sure to delete this item?")&&i!==-1&&l.value.params.splice(i,1)},handleParamSubmit(i){var w;i.update||((w=l.value)!=null&&w.params||(l.value.params=[]),l.value.params.push(i.data))}}}}),ne={key:0},le={key:1};function te(e,a,s,u,m,d){const l=b("ui-input-vue"),r=b("ui-round-btn-vue"),f=b("form-task-param-vue");return k(),C(E,null,[o(F,{ref:"popup","transition-show":"rotate","transition-hide":"rotate",persistent:""},{default:t(()=>[o(V,{style:{"min-width":"350px"}},{default:t(()=>[o(g,null,{default:t(()=>[o(q,{class:"q-gutter-md",onSubmit:U(e.handleSubmit,["prevent"])},{default:t(()=>[o(l,{modelValue:e.localProp.id,"onUpdate:modelValue":a[0]||(a[0]=n=>e.localProp.id=n),hint:"Identifier *",disable:e.disable},null,8,["modelValue","disable"]),o(l,{modelValue:e.localProp.name,"onUpdate:modelValue":a[1]||(a[1]=n=>e.localProp.name=n),hint:"Name *"},null,8,["modelValue"]),o(l,{modelValue:e.localProp.api,"onUpdate:modelValue":a[2]||(a[2]=n=>e.localProp.api=n),hint:"Api *"},null,8,["modelValue"]),o(B,{modelValue:e.localProp.note,"onUpdate:modelValue":a[3]||(a[3]=n=>e.localProp.note=n),dense:"",outlined:"",hint:"Description"},null,8,["modelValue"]),o(h,{dense:"",class:"wd-320",outline:"",color:"grey",label:e.labelBtnParams,onClick:a[4]||(a[4]=n=>e.showParams=!e.showParams)},null,8,["label"]),e.showParams?(k(),C("div",ne,[o(I,{"hide-header":"","hide-bottom":"",rows:e.localProp.params,columns:e.columns,"row-key":"name"},{"body-cell-actions":t(n=>[o(y,{props:n},{default:t(()=>[o(r,{color:"primary",icon:"add",tooltip:"Create parameter",onClick:e.handleAdd},null,8,["onClick"]),o(r,{color:"positive",icon:"mode_edit",tooltip:"Edit parameter",onClick:p=>e.handleEdit(n.row)},null,8,["onClick"]),o(r,{color:"negative",icon:"delete",tooltip:"Delete parameter",onClick:p=>e.handleDelete(n.rowIndex)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns"])])):P("",!0),e.showBtnAddParam?(k(),C("div",le,[o(h,{class:"wd-320",dense:"",label:"Add",color:"primary",onClick:a[5]||(a[5]=n=>e.handleAdd())})])):P("",!0),o(D,{align:"left",class:"text-primary"},{default:t(()=>[o(h,{label:"Submit",type:"submit",color:"primary"}),o(h,{label:"Cancel",color:"primary",flat:"",class:"q-ml-sm",onClick:e.handleCancel},null,8,["onClick"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},512),o(f,{ref:"form",onSubmit:e.handleParamSubmit},null,8,["onSubmit"])],64)}const se=$(ae,[["render",te],["__scopeId","data-v-8e5b00b7"]]);const re=[{name:"state"},{name:"id"},{name:"job"},{name:"note"},{name:"params"},{name:"actions"}],ie=S({name:"PageTasks",components:{UiBoxVue:z,UiRoundBtnVue:N,FormTaskVue:se},setup(){const e=c([]),a=J(e),s=c(null),u=c({}),m={xl:6,lg:7,md:7,sm:11,xs:10},d=_(()=>e.value.length===0),l=c(!1),{handleAdd:r,handleEdit:f,handleSubmit:n,handleDelete:p,handleCancel:v}=K(l,s,e,a,{});return M(async()=>{e.value=await a.Get(!0)}),{columns:re,rows:e,task:u,buttonShow:d,wrapper:a,form:s,boxCols:m,visible:l,handleAdd:r,handleEdit:f,handleSubmit:n,handleDelete:p,handleCancel:v,handleRun:async i=>{await Y(i.api)&&L.create({type:"info",message:"Task completed"})}}}}),ue={class:"text-subtitle1 text-bold text-primary"},me={class:"text-subtitle2"};function de(e,a,s,u,m,d){const l=b("ui-round-btn-vue"),r=b("ui-box-vue"),f=b("form-task-vue");return k(),C(E,null,[o(r,{columns:e.boxCols,header:"Tasks Management",buttonShow:e.buttonShow,buttonLabel:"Add",buttonClick:e.handleAdd},{default:t(()=>[o(I,{"hide-header":"",dense:"",rows:e.rows,columns:e.columns,"row-key":"name","rows-per-page-options":[10,50,100,0]},{"body-cell-state":t(n=>[o(y,{props:n,class:"wd-40"},{default:t(()=>[o(W,{name:"task",size:"2rem"})]),_:2},1032,["props"])]),"body-cell-job":t(n=>[o(y,{props:n},{default:t(()=>[o(V,{square:"",flat:""},{default:t(()=>[o(g,{align:"left"},{default:t(()=>[T("div",ue,A(n.row.name),1),T("div",me,A(n.row.note),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-actions":t(n=>[o(y,{props:n},{default:t(()=>[o(l,{color:"primary",icon:"add",tooltip:"Create task",onClick:e.handleAdd},null,8,["onClick"]),o(l,{color:"primary",icon:"mdi-run",tooltip:"Run task",onClick:p=>e.handleRun(n.row)},null,8,["onClick"]),o(l,{color:"positive",icon:"mode_edit",tooltip:"Edit task",onClick:p=>e.handleEdit(n.row)},null,8,["onClick"]),o(l,{color:"negative",icon:"delete",tooltip:"Delete task",onClick:p=>e.handleDelete(n.row)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns"])]),_:1},8,["columns","buttonShow","buttonClick"]),e.visible?(k(),Q(f,{key:0,ref:"form",onSubmit:e.handleSubmit,onCancel:e.handleCancel},null,8,["onSubmit","onCancel"])):P("",!0)],64)}const Be=$(ie,[["render",de],["__scopeId","data-v-759981a5"]]);export{Be as default};
